(()=>{let e=document.querySelector.bind(document),t=e("#select-srt-file"),n=e("#srt"),o=e("#select-jy-file"),a=e("#jy-file"),i=e("#make-btn"),r=e("#zsm-btn"),l=e("#new-jy-file"),s=e("#save-btn"),c=e("#saveAsFilePicker");function d(e,t){let n=e.files[0],o=new FileReader;o.readAsText(n),o.onload=function(){t.value=o.result},o.onerror=function(){console.log(o.error)}}function u(){const e=e=>[...Array(e)].map((()=>Math.floor(16*Math.random()).toString(16))).join("").toUpperCase();return[e(8),e(4),e(4).toLowerCase(),e(4),e(12)].join("-")}function f(e){let[t,n]=e.split(","),[o,a,i]=t.split(":");return 1e3*(1e3*(60*(60*parseInt(o)+parseInt(a))+parseInt(i))+parseInt(n))}function _(){return navigator.platform.toUpperCase().indexOf("MAC")>=0}function p(e=!1){let t=l.value;if(!t.trim())return alert("尚未生成字幕文本"),!1;let n="draft_content.json";_()&&(n="draft_info.json");let o=new Blob([t],{type:"application/json"});e?async function(e,t){const n=await window.showSaveFilePicker(),o=await n.createWritable();await o.write(e),await o.close(),alert("另存成功！")}(o):function(e,t){if(console.log("download"),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var n=document.createElement("a"),o=URL.createObjectURL(e);n.href=o,n.download=t,document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(o)}),0)}}(o,n)}window.showSaveFilePicker&&(e("#saveAsFilePicker").style.display="inline-block"),document.addEventListener("DOMContentLoaded",(function(){_()&&e("body").classList.add("is-mac-os")}),!1),o.addEventListener("change",(function(){d(this,a)})),t.addEventListener("change",(function(){d(this,n)})),i.addEventListener("click",(function(){let e=function(){let e=n.value;if(!e)return void alert("请先选择字幕文件");let t=e.split("\n\n"),o=[];return t.forEach((e=>{if(e){let t=/\d+\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/gm;const n=/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/gm.exec(e);if(Array.isArray(n)&&n.length>1){let a=f(n[1]),i=f(n[2])-a;const r=e.replace(t,"").trim();o.push({content:r,target_timerange:{duration:i,start:a}})}}})),o}(),t=function(){let e=a.value.trim();if(e)return JSON.parse(e);alert("请先选择剪映工程文件！！！")}();e&&t&&function(e,t){let n=(o=t.materials)&&o.texts&&o.texts[0]?o.texts[0]:{alignment:1,background_alpha:1,background_color:"",bold_width:0,border_color:"",border_width:.08,check_flag:7,content:"www.mzh.ren",font_category_id:"",font_category_name:"",font_id:"",font_name:"",font_resource_id:"",font_size:5,font_title:"系统",font_url:"",has_shadow:!1,id:"A4E54311-7BD7-40b8-9FCF-605E1A8C6855",initial_scale:1,italic_degree:0,ktv_color:"",layer_weight:0,letter_spacing:0,line_spacing:.02,shadow_alpha:.8,shadow_angle:-45,shadow_color:"#000000",shadow_distance:8,shadow_point:{x:1.0182337649086284,y:-1.0182337649086284},shadow_smoothing:1,shape_clip_x:!1,shape_clip_y:!1,style_name:"",sub_type:0,text_alpha:1,text_color:"#FFFFFF",text_size:30,text_to_audio_ids:[],type:"lyrics",typesetting:0,underline:!1,underline_offset:.22,underline_width:.05,use_effect_default_color:!0};var o;console.log(n);let a=function(e){const t=function(e){let t=[];return e&&e.length&&e.forEach((e=>{"text"!=e.type&&"sticker"!=e.type||(t=t.concat(e.segments))})),t}(e);return t.length>0?t[0]:{cartoon:!1,clip:{alpha:1,flip:{horizontal:!1,vertical:!1},rotation:0,scale:{x:1,y:1},transform:{x:0,y:-.73}},enable_adjust:!0,enable_color_curves:!0,enable_lut:!0,extra_material_refs:["8606C536-7613-4144-A122-9D7F82761120"],group_id:"",id:"20D2EA9B-E6B1-4252-9865-FE375C8A4F5B",intensifies_audio:!1,is_tone_modify:!1,keyframe_refs:[],last_nonzero_volume:1,material_id:"D91E3206-DF4A-4abf-8100-9B7D71EF4AB7",render_index:14003,reverse:!1,source_timerange:null,speed:1,target_timerange:{duration:6633333,start:534e5},visible:!0,volume:1}}(t.tracks),i=[],r=[];var s;e.forEach((e=>{let t=u(),o=u(),l={...n,id:t,content:e.content},s={...a,id:o,target_timerange:e.target_timerange,material_id:t};i.push(l),r.push(s)})),t.materials.texts=i,(s=t.tracks)&&s.length&&s.forEach(((e,t)=>{"text"!=e.type&&"sticker"!=e.type||s.splice(t,1)})),t.tracks.push({type:"text",flag:t.tracks.length,id:u(),segments:r}),l.value=JSON.stringify(t)}(e,t)})),s.addEventListener("click",(()=>{p()})),c.addEventListener("click",p),r.addEventListener("click",(function(){"block"==e("#zsm-img").style.display?e("#zsm-img").style.display="none":e("#zsm-img").style.display="block"}))})(),(()=>{function e(e){return decodeURIComponent(window.atob(e))}document.addEventListener("DOMContentLoaded",(function(){!function(e,t){console.log(e,t);var n=top.window.location.hostname;-1==n.indexOf(e)&&"localhost"!=n&&top.window.location.assign(t)}(e("bXpoLnJlbg=="),e("aHR0cHM6Ly9qeS5temgucmVuLw=="))}))})();